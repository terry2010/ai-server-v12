# AI-Server-v12 需求对齐结论（v1）

> 本文档记录 2025-11-26 与产品方就 AI-Server-v12 桌面应用的前期需求对齐结论，供后续开发与评审时复核。

## 1. 首批必须支持的模块清单

- **优先级与节奏**
  - 第一阶段（功能开发主线阶段）：**仅支持 `n8n` + `OneAPI`**。
  - 第二阶段（在主线功能基本完成后）：新增支持 **`Dify` + `RagFlow`**。
- **含义**
  - 所有架构设计（模块注册表、Compose 模板、UI 显示结构）在第一阶段就要预留扩展能力，但真正接入 Dify / RagFlow 的时间可以靠后。

## 2. Docker 编排来源

- 不复用旧仓库中的 docker-compose 配置。
- 由本项目 **从零设计全新的 Docker / docker-compose 编排方案**：
  - 依据当前模块需求和最佳实践重新规划网络、卷、环境变量、依赖关系等；
  - 兼顾后续扩展（Dify、RagFlow、未来的本地大模型服务等）。

## 3. Docker 运行模式与依赖假设

- 客户端启动后需检查客户机是否安装 Docker：
  - 如未安装：
    - 在 UI 中提示用户下载并安装 **Docker Desktop**；
    - 提供跳转到 Docker Desktop 官网的快捷方式和必要说明。
  - 如已安装但未运行：
    - 在 Windows 上提供“尝试启动 Docker Desktop”的辅助按钮。
- **所有容器相关功能均通过 Docker Desktop 提供的 Docker Engine 来实现**：
  - 不考虑独立安装的 Docker Engine 或其他容器方案的特殊适配；
  - 以 Docker Desktop（特别是 Windows 环境）为默认假设。

## 4. 网络与安全要求

- **默认网络暴露策略**：
  - 默认仅监听与暴露在 `localhost`（本机回环地址）；
  - 不默认对局域网其他机器开放访问。
- **局域网开放配置**：
  - 在控制中心（Settings）中提供选项，允许用户主动将某些模块服务开放到局域网；
  - 打开时需要清晰风险提示（但具体文案可后续补充）。
- **账号与登录信息管理**：
  - 对各模块（n8n / Dify / OneAPI / RagFlow 等）的默认账号密码、安全策略，**不做统一约束**；
  - 本客户端 **不负责管理/存储这些模块的登录信息**，避免引入额外安全与合规复杂度。

## 5. 语言与国际化策略

- **v1 就需要支持中英文双语**：
  - 至少覆盖主流程页面（Dashboard / Settings / Logs / Monitoring / 模块页）和关键提示文案。
- **默认语言选择规则**：
  - 若系统语言为简体中文或繁体中文 → 应用默认使用 **中文界面**；
  - 其他系统语言 → 应用默认使用 **英文界面**。
- 允许用户在 Settings 中手动切换语言（如后续实现 i18n 切换功能）。

## 6. 日志功能需求

- 关注重点：**快速定位错误与异常**。
- 功能要求：
  - 支持完整的日志搜索与过滤能力：
    - 按模块、级别、时间范围等维度过滤；
    - 支持关键字搜索。
  - 支持 **日志导出** 功能：
    - 便于用户将日志打包后发给技术支持进行分析；
    - 导出格式可为文本或压缩文件，具体实现可后续细化。

## 7. 危险操作与 Docker 资源清理

- “清理 Docker 资源”属于 **开发/高级选项**，而非普通用户日常操作。
- 需要提供 **尽可能完整的 Docker 清理能力**，包括但不限于：
  - 删除由本应用管理的容器、镜像、网络、卷；
  - 提供更强力的“一键清空相关资源”选项（需在 UI 中增加明显的风险提示和二次确认）。
- 具体清理范围和标签策略在实现阶段再详细设计，但方向是：**能力齐全、操作前风险可感知**。

## 8. 配置持久化与文件位置

- 配置存储位置：
  - 接受将配置文件存放在 Electron 推荐的 `userData` 路径中（随用户而非随仓库）；
  - 有利于后续应用升级与迁移。
- 配置可手工编辑：
  - 配置格式应保持 **文本化、结构清晰、可读/可手动编辑**（如 JSON / YAML 等）；
  - 文档中后续可补充简单的编辑说明，方便高级用户排查与修改。

## 9. 包管理器与 Node 版本

- 包管理器：
  - 优先使用 **npm**，与当前开发机习惯保持一致。
- Node 版本：
  - 产品方对 Node 版本无特殊偏好；
  - 开发时可选择本人最熟悉且生态成熟的 LTS 版本（例如 Node 18+ 或 20+），在 README 中明确标注。

---

> 后续如有新增或变更，这份文档可以按版本号或日期进行更新，以便与实现保持同步。
